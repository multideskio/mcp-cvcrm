# Cursor Rules para CV CRM MCP Server

## ğŸ“š DocumentaÃ§Ã£o

Sempre consulte a documentaÃ§Ã£o na pasta `docs/` antes de fazer alteraÃ§Ãµes:

1. **VisÃ£o Geral:** docs/00-PROJECT-OVERVIEW.md
2. **Arquitetura:** docs/01-ARCHITECTURE.md
3. **AutenticaÃ§Ã£o:** docs/02-AUTHENTICATION.md
4. **API Endpoints:** docs/03-API-ENDPOINTS.md
5. **MCP Tools:** docs/04-MCP-TOOLS.md
6. **Deploy:** docs/05-DEPLOYMENT.md

## ğŸ¯ Regras de Desenvolvimento

### Estrutura de Arquivos

- MÃ³dulos em `src/lib/`
- Types em `src/types/`
- ConfiguraÃ§Ãµes em `src/config/`
- MCP Tools em `src/lib/mcp/tools/`
- Entry point MCP em `src/mcp/index.ts`

### TypeScript

- Sempre tipar variÃ¡veis e funÃ§Ãµes
- Usar `z.infer<typeof schema>` para types de schemas Zod
- Evitar `any`, preferir `unknown`
- Usar interfaces para objetos pÃºblicos, types para unions/intersections

### ValidaÃ§Ã£o

- Validar inputs com Zod antes de usar
- LanÃ§ar erros tipados (`ValidationError`, `AuthenticationError`, etc)
- Sanitizar strings de usuÃ¡rio

### Errors

- Usar classes de erro customizadas em `lib/utils/errors.ts`
- Sempre logar erros com contexto
- Mensagens user-friendly no MCP

### Logs

- Usar `logger` de `lib/utils/logger.ts`
- Log level apropriado (debug, info, warn, error)
- Incluir contexto relevante nos logs
- NÃ£o logar dados sensÃ­veis (tokens, senhas)

### MCP Tools

- Um arquivo por categoria em `lib/mcp/tools/`
- Schema Zod para validaÃ§Ã£o
- Tool definition seguindo padrÃ£o MCP
- Handler async retornando string formatada
- Usar emojis e markdown para respostas user-friendly

### AutenticaÃ§Ã£o

- Sempre usar `getAuthManager().getToken()`
- NÃ£o armazenar tokens em variÃ¡veis globais
- Renovar automaticamente quando expirado
- Cache no Redis com TTL

### Cache (Redis)

- Usar padrÃµes de keys de `config/redis.ts`
- Definir TTL apropriado
- Invalidar cache quando necessÃ¡rio
- Tratar erros de cache gracefully

### API Client

- Um mÃ©todo por endpoint
- Validar inputs antes de chamar API
- Tratar erros especÃ­ficos (401, 404, 422)
- Logar sucesso e erros

## ğŸš« NÃ£o Fazer

- âŒ NÃ£o commitar `.env`
- âŒ NÃ£o usar `console.log` (usar `logger`)
- âŒ NÃ£o ignorar erros de validaÃ§Ã£o
- âŒ NÃ£o fazer requests sem autenticaÃ§Ã£o
- âŒ NÃ£o armazenar dados sensÃ­veis em logs
- âŒ NÃ£o criar tools sem documentar em docs/04-MCP-TOOLS.md

## âœ… Fazer Sempre

- âœ… Consultar documentaÃ§Ã£o antes de mudar cÃ³digo
- âœ… Validar inputs com Zod
- âœ… Logar operaÃ§Ãµes importantes
- âœ… Usar tipos TypeScript estritos
- âœ… Atualizar documentaÃ§Ã£o ao adicionar funcionalidades
- âœ… Seguir padrÃµes de nomenclatura do projeto
- âœ… Tratar erros de forma apropriada

## ğŸ”„ Workflow

1. Ler documentaÃ§Ã£o relevante em `docs/`
2. Implementar seguindo padrÃµes existentes
3. Validar com TypeScript (`npm run type-check`)
4. Testar localmente
5. Atualizar documentaÃ§Ã£o se necessÃ¡rio
6. Commit com mensagem descritiva

## ğŸ“ Commits

- `feat:` Nova funcionalidade
- `fix:` CorreÃ§Ã£o de bug
- `docs:` AtualizaÃ§Ã£o de documentaÃ§Ã£o
- `refactor:` RefatoraÃ§Ã£o
- `test:` Testes
- `chore:` Tarefas de manutenÃ§Ã£o

## ğŸ¨ FormataÃ§Ã£o de Respostas MCP

- Usar emojis apropriados (âœ… sucesso, âŒ erro, ğŸ“‹ lista, etc)
- Markdown para formataÃ§Ã£o
- InformaÃ§Ãµes relevantes (IDs, protocolos, datas)
- PrÃ³ximos passos quando aplicÃ¡vel
- Mensagens de erro claras e acionÃ¡veis

